<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ALCOBINA â€” Portal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --primary-color: #667eea;
      --muted: #98a0b3;
      --border-color: #e6e9ef;
      --bg: #f3f6fb;            /* lighter background for modern look */
      --card-bg: rgba(255,255,255,0.75);
      --glass-blur: 6px;
      --shadow-sm: 0 6px 18px rgba(19,24,40,0.06);
      --shadow-md: 0 12px 30px rgba(102, 126, 234, 0.12);
      --radius: 12px;
      --radius-lg: 18px;
      --gap: 16px;
      --transition: 220ms cubic-bezier(.2,.9,.2,1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      font-family: Inter, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: #102030;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    a { color: inherit; text-decoration: none; }

    /* ---------- Login styles ---------- */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      background: linear-gradient(180deg, rgba(247,250,255,0.6) 0%, rgba(240,244,255,0.9) 100%);
    }

    .login-card {
      width: 100%;
      max-width: 520px;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 36px;
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(var(--glass-blur));
      border: 1px solid rgba(13,27,62,0.04);
    }

    .login-header { text-align: center; margin-bottom: 18px; }
    .login-header h1 {
      font-size: 28px;
      margin-bottom: 6px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .login-header p { color: var(--muted); font-size: 13px }

    .form-group { margin-bottom: 14px; }
    .form-group label { display: block; margin-bottom: 8px; font-size: 13px; color: #243244; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid var(--border-color);
      font-size: 14px; background: rgba(255,255,255,0.85);
    }
    .form-group input:focus { outline: none; box-shadow: 0 8px 24px rgba(102,126,234,0.06); border-color: var(--primary-color); }

    .btn-primary {
      width: 100%; padding: 12px; border-radius: 10px; border: none; color: white;
      background: var(--primary-gradient); font-weight: 700; font-size: 15px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      transition: transform var(--transition), box-shadow var(--transition);
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }

    .error-message {
      background-color: #fff1f2;
      color: #991b1b;
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 12px;
      font-size: 14px;
      display: none;
      align-items: center;
      gap: 10px;
    }
    .error-message.show { display: flex; }

    /* ---------- App / Sidebar ---------- */
    .app-container { display: flex; min-height: 100vh; width: 100%; }

    #sidebar {
      width: 260px;
      background: var(--primary-gradient);
      color: white;
      display: flex;
      flex-direction: column;
      transition: width 0.25s ease, transform 0.25s ease;
      padding: 18px;
      gap: 12px;
      box-shadow: 0 10px 30px rgba(16,24,40,0.06);
    }

    .sidebar-header {
      padding: 10px;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      background: rgba(255,255,255,0.04);
    }

    .menu-items {
      flex: 1;
      overflow-y: auto;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .menu-item {
      padding: 12px;
      cursor: pointer;
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 15px;
      border-radius: 8px;
      transition: background var(--transition), transform var(--transition);
      color: rgba(255,255,255,0.95);
    }
    .menu-item:hover { background: rgba(255,255,255,0.08); transform: translateY(-2px); }
    .menu-item.active { background: rgba(255,255,255,0.12); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03); }

    .sidebar-footer { margin-top: auto; display:flex; flex-direction:column; gap:8px; }
    .logout-btn { width:100%; padding:10px; border-radius:8px; border:none; background: rgba(255,255,255,0.12); color:white; cursor:pointer; }

    #mobile-toggle-btn {
      display:none;
      position:fixed;
      top:18px;
      left:18px;
      z-index:600;
      background:var(--primary-gradient);
      color:white;
      border:none;
      border-radius:50%;
      width:48px;
      height:48px;
      font-size:18px;
      box-shadow:var(--shadow-md);
      cursor:pointer;
      align-items:center;
      justify-content:center;
    }

    /* ---------- Main content (full-bleed hero for home) ---------- */
    #main-content {
      flex: 1;
      overflow: auto;
      min-height: 100vh;
      position: relative;
      background: linear-gradient(180deg, rgba(243,246,255,0.8) 0%, rgba(250,251,255,0.95) 100%);
    }

    /* Home hero: full-bleed, modern, no white container */
    .welcome-hero {
      min-height: 70vh;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px;
      padding: 72px 48px;
      background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.04));
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .hero-content {
      max-width: 980px;
      width: 100%;
      display:flex;
      gap: 28px;
      align-items: center;
    }

    .hero-text {
      flex: 1 1 60%;
    }

    .hero-title {
      font-size: 48px;
      font-weight: 800;
      line-height: 1.02;
      margin-bottom: 10px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero-sub {
      color: var(--muted);
      font-size: 18px;
      margin-bottom: 18px;
    }

    .hero-cta { display:flex; gap:12px; align-items:center; }

    .hero-cta .btn-primary { width: auto; padding: 12px 18px; border-radius: 10px; }

    .hero-stats {
      flex: 1 1 40%;
      display:flex;
      gap:12px;
      align-items:stretch;
      justify-content:flex-end;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: var(--shadow-sm);
      min-width: 160px;
      text-align: left;
      border: 1px solid var(--border-color);
    }
    .stat-card h4 { margin-bottom:8px; font-size:14px; color:#334155 }
    .stat-number { font-size:20px; font-weight:800; color:#0f1724 }

    /* ---------- Sections (Inventory, Price List, Customers) ---------- */
    .section {
      display: none;
      padding: 28px;
    }
    .section.active { display: block; }

    .card {
      background: white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .data-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:16px; }

    table { width:100%; border-collapse:collapse; font-size:14px; }
    thead th { padding:12px; text-align:left; font-size:13px; color:white; background: linear-gradient(135deg, #4a90e2 0%, #764ba2 100%); text-transform:uppercase; }
    tbody td { padding:12px; border-bottom:1px solid var(--border-color); color:#243244 }

    .inline-form { display:flex; gap:8px; align-items:center; margin-bottom:12px; }

    /* empty state */
    .empty-state { text-align:center; padding:32px; border-radius:12px; background:white; box-shadow:var(--shadow-sm) }
    .empty-state i { font-size:48px; margin-bottom:12px; color:var(--primary-color) }

    /* responsive */
    @media (max-width: 960px) {
      .hero-title { font-size: 36px }
      .welcome-hero { padding: 48px 20px; min-height:60vh; }
    }
    @media (max-width: 768px) {
      #mobile-toggle-btn { display:flex; }
      #sidebar { position: fixed; left: -320px; top: 0; height: 100vh; z-index: 600; }
      #sidebar.show { left: 0; }
      .hero-stats { display:none; }
      .hero-content { flex-direction: column; align-items:flex-start; }
      .welcome-hero { padding: 36px 18px; min-height: 56vh; }
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="loginPage" class="login-container" aria-hidden="false">
    <div class="login-card" role="dialog" aria-labelledby="loginTitle">
      <div class="login-header">
        <h1 id="loginTitle">ALCOBINA</h1>
        <p>Sign in to manage inventory, prices and sales</p>
      </div>

      <div id="loginError" class="error-message" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span id="loginErrorText"></span>
      </div>

      <form id="loginForm" autocomplete="on">
        <div class="form-group">
          <label for="loginEmail"><i class="fas fa-envelope"></i> Email Address</label>
          <input type="email" id="loginEmail" required placeholder="you@business.com" autocomplete="email">
        </div>

        <div class="form-group">
          <label for="loginPassword"><i class="fas fa-lock"></i> Password</label>
          <input type="password" id="loginPassword" required placeholder="Your password" autocomplete="current-password">
        </div>

        <button type="submit" class="btn-primary" id="loginBtn"><i class="fas fa-sign-in-alt"></i> <span id="loginBtnText">Login</span></button>

        <div style="margin-top:12px; display:flex; gap:8px;">
          <button type="button" id="registerBtn" class="btn-primary" style="background:#10b981;">Register</button>
        </div>
      </form>
    </div>
  </div>

  <!-- APP -->
  <div id="appContainer" class="app-container" style="display:none;">
    <button id="mobile-toggle-btn" onclick="toggleSidebar()" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>

    <!-- SIDEBAR -->
    <aside id="sidebar" aria-label="Sidebar">
      <div class="sidebar-header" onclick="toggleSidebar()" role="button">
        <i class="fas fa-store"></i> <span>ALCOBINA</span>
      </div>

      <nav class="menu-items" aria-label="Main navigation">
        <div class="menu-item active" id="menu-home" onclick="showWelcome(this)"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="menu-item" id="menu-inventory" onclick="showInventory(this)"><i class="fas fa-boxes"></i><span>Inventory</span></div>
        <div class="menu-item" id="menu-pos" onclick="showPOS(this)"><i class="fas fa-cash-register"></i><span>POS</span></div>
        <div class="menu-item" id="menu-price" onclick="showPriceList(this)"><i class="fas fa-tags"></i><span>Price List</span></div>
        <div class="menu-item" onclick="showComingSoon('Sales Dashboard', 'chart-line')"><i class="fas fa-chart-line"></i><span>Sales Dashboard</span></div>
        <div class="menu-item" id="menu-customers" onclick="showCustomers(this)"><i class="fas fa-users"></i><span>Customers</span></div>
        <div class="menu-item" id="menu-lookup" onclick="showItemLookup(this)"><i class="fas fa-search"></i><span>Item Lookup</span></div>
        <div class="menu-item" onclick="showComingSoon('Collections', 'money-bill-wave')"><i class="fas fa-money-bill-wave"></i><span>Collections</span></div>
        <div class="menu-item" onclick="showComingSoon('Purchase History', 'shopping-cart')"><i class="fas fa-shopping-cart"></i><span>Purchase History</span></div>
      </nav>

      <div class="sidebar-footer">
        <div id="sidebarUserEmail" style="font-size:13px; color:rgba(255,255,255,0.9)">â€”</div>
        <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        <div style="font-size:12px; color:rgba(255,255,255,0.85);">Powered by <strong>ALCOBINA</strong></div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main id="main-content" role="main" tabindex="-1">
      <!-- HOME HERO (no card) -->
      <section id="welcome-section" class="welcome-hero" aria-labelledby="welcomeTitle" style="display:flex;">
        <div class="hero-content">
          <div class="hero-text">
            <h2 class="hero-title" id="welcomeTitle">Welcome, <span id="welcome-username">User</span> ðŸ‘‹</h2>
            <p class="hero-sub">Manage your inventory, price lists and sales â€” <strong id="business-name-display">ALCOBINA Business</strong></p>
            <div class="hero-cta">
              <button class="btn-primary" onclick="showPriceList();">View Price List</button>
              <button class="btn-primary" style="background:#14b8a6;" onclick="showInventory();"><i class="fas fa-boxes"></i> Inventory</button>
            </div>
          </div>

          <div class="hero-stats" aria-hidden="false">
            <div class="stat-card">
              <h4>Items</h4>
              <div class="stat-number" id="stat-items">â€”</div>
            </div>
            <div class="stat-card">
              <h4>Last Sale</h4>
              <div class="stat-number" id="stat-last-sale">â€”</div>
            </div>
          </div>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="inventory-section" class="section" aria-labelledby="inventoryTitle">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <h3 id="inventoryTitle">Inventory</h3>
          <div style="display:flex; gap:8px;">
            <button class="btn-primary" onclick="loadItems()">Refresh</button>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <form id="addItemForm" onsubmit="return false;" class="inline-form">
            <input id="itemName" placeholder="Item name" required style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--border-color);" />
            <input id="itemPrice" placeholder="Price" type="number" step="0.01" style="width:140px; padding:10px; border-radius:10px; border:1px solid var(--border-color);" />
            <button class="btn-primary" type="button" onclick="addItem()">Add Item</button>
          </form>
        </div>

        <div class="card data-table-container">
          <table id="itemsTable" aria-describedby="inventoryTitle">
            <thead>
              <tr><th>Name</th><th>Price</th><th>Added By</th><th>Added At</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- PRICE LIST -->
      <section id="price-section" class="section" aria-labelledby="priceTitle">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <h3 id="priceTitle">Price List</h3>
          <button class="btn-primary" onclick="loadItems()">Reload Prices</button>
        </div>

        <div id="priceGrid" class="data-grid">
          <!-- price cards inserted here -->
        </div>
      </section>

      <!-- CUSTOMERS -->
      <section id="customers-section" class="section" aria-labelledby="customersTitle">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3 id="customersTitle">Customers</h3>
        </div>

        <div style="margin-top:12px;">
          <div class="empty-state">
            <i class="fas fa-users"></i>
            <h3>No customers yet</h3>
            <p>Add customers from POS (coming soon).</p>
          </div>
        </div>
      </section>

      <!-- POS (stub) -->
      <section id="pos-section" class="section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3>POS</h3>
        </div>
        <div style="margin-top:12px;">
          <div class="empty-state">
            <i class="fas fa-cash-register"></i>
            <h3>POS coming soon</h3>
            <p>Quick sales interface will be added here.</p>
          </div>
        </div>
      </section>

      <!-- Item lookup (stub) -->
      <section id="lookup-section" class="section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3>Item Lookup</h3>
        </div>
        <div style="margin-top:12px;">
          <div class="card">
            <input id="lookupInput" placeholder="Search items..." style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-color);" />
            <div id="lookupResults" style="margin-top:12px;"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase + App Script -->
  <script type="module">
    // Use Firebase modular SDK via CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy, doc, updateDoc, deleteDoc, where } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Your firebase config (you provided these values)
    const firebaseConfig = {
      apiKey: "AIzaSyDbZVw5MVgrfFWAbTPByaUmKdbz0xPKofw",
      authDomain: "alcobina.firebaseapp.com",
      projectId: "alcobina",
      storageBucket: "alcobina.firebasestorage.app",
      messagingSenderId: "437821923842",
      appId: "1:437821923842:web:ea90ea7c256659ab3cfd1b",
      measurementId: "G-TCJLJRJ2B4"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch (e) { console.info('Analytics not initialized (likely not supported in this environment).'); }
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* -------------------------
       UI Elements
       ------------------------- */
    const loginPage = document.getElementById('loginPage');
    const appContainer = document.getElementById('appContainer');
    const loginForm = document.getElementById('loginForm');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const loginError = document.getElementById('loginError');
    const loginErrorText = document.getElementById('loginErrorText');
    const loginBtnText = document.getElementById('loginBtnText');
    const registerBtn = document.getElementById('registerBtn');
    const sidebarUserEmail = document.getElementById('sidebarUserEmail');
    const welcomeUsername = document.getElementById('welcome-username');
    const businessNameDisplay = document.getElementById('business-name-display');

    const statItems = document.getElementById('stat-items');
    const statLastSale = document.getElementById('stat-last-sale');

    /* -------------------------
       Section helpers
       ------------------------- */
    function clearActiveMenu() {
      document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
    }

    function showSectionElement(sectionId) {
      // hide all
      document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
      const el = document.getElementById(sectionId);
      if (el) el.style.display = (sectionId === 'welcome-section') ? 'flex' : 'block';
      // set active menu if any
      clearActiveMenu();
    }

    // Functions used by sidebar onclicks
    function showWelcome(menuEl) {
      showSectionElement('welcome-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }
    function showInventory(menuEl) {
      showSectionElement('inventory-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }
    function showPOS(menuEl) {
      showSectionElement('pos-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }
    function showPriceList(menuEl) {
      showSectionElement('price-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }
    function showCustomers(menuEl) {
      showSectionElement('customers-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }
    function showItemLookup(menuEl) {
      showSectionElement('lookup-section');
      if (menuEl) { clearActiveMenu(); menuEl.classList.add('active'); }
    }

    function showComingSoon(title) {
      alert(title + " is coming soon.");
    }

    function toggleSidebar() {
      const sb = document.getElementById('sidebar');
      if (!sb) return;
      sb.classList.toggle('show');
    }

    /* -------------------------
       Authentication handlers
       ------------------------- */
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginError.classList.remove('show');
      loginBtnText.innerText = 'Logging in...';
      try {
        const email = (loginEmail.value || '').trim();
        const password = loginPassword.value || '';
        if (!email || !password) throw new Error('Please enter email and password');
        await signInWithEmailAndPassword(auth, email, password);
        // onAuthStateChanged will update UI
      } catch (err) {
        loginErrorText.textContent = err.message || 'Login failed';
        loginError.classList.add('show');
        console.error('Sign-in error:', err);
      } finally {
        loginBtnText.innerText = 'Login';
      }
    });

    registerBtn.addEventListener('click', async () => {
      const email = (loginEmail.value || '').trim();
      const password = loginPassword.value || '';
      if (!email || !password) { alert('Enter email & password to register'); return; }
      try {
        registerBtn.disabled = true;
        registerBtn.textContent = 'Registering...';
        await createUserWithEmailAndPassword(auth, email, password);
        alert('Registered and signed in.');
      } catch (err) {
        alert('Register error: ' + err.message);
        console.error('Register error:', err);
      } finally {
        registerBtn.disabled = false;
        registerBtn.textContent = 'Register';
      }
    });

    async function logout() {
      try {
        await signOut(auth);
      } catch (err) {
        console.error('Logout error:', err);
        alert('Error logging out: ' + err.message);
      }
    }

    // Auth state listener
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // signed in
        loginPage.style.display = 'none';
        appContainer.style.display = 'flex';
        welcomeUsername.textContent = user.displayName || (user.email ? user.email.split('@')[0] : 'User');
        sidebarUserEmail.textContent = user.email || '';
        businessNameDisplay.textContent = 'ALCOBINA Business';
        await loadItems(); // load items on sign-in
      } else {
        // signed out
        appContainer.style.display = 'none';
        loginPage.style.display = 'flex';
      }
    });

    /* -------------------------
       Firestore: items collection
       ------------------------- */
    async function addItem() {
      const nameEl = document.getElementById('itemName');
      const priceEl = document.getElementById('itemPrice');
      const name = (nameEl.value || '').trim();
      const price = parseFloat(priceEl.value || 0) || 0;
      if (!name) { alert('Enter item name'); return; }
      try {
        const user = auth.currentUser;
        await addDoc(collection(db, 'items'), {
          name,
          price,
          createdBy: user ? user.uid : null,
          createdByEmail: user ? user.email : null,
          createdAt: serverTimestamp()
        });
        nameEl.value = '';
        priceEl.value = '';
        await loadItems();
      } catch (err) {
        console.error('Add item error:', err);
        alert('Could not add item: ' + err.message);
      }
    }

    // Edit and delete helpers
    async function deleteItem(id) {
      if (!confirm('Delete this item?')) return;
      try {
        await deleteDoc(doc(db, 'items', id));
        await loadItems();
      } catch (err) {
        console.error('Delete item error:', err);
        alert('Could not delete item: ' + err.message);
      }
    }

    async function editItem(id) {
      const newName = prompt('New name:');
      if (newName === null) return;
      const newPriceRaw = prompt('New price:');
      if (newPriceRaw === null) return;
      const newPrice = parseFloat(newPriceRaw || 0) || 0;
      try {
        await updateDoc(doc(db, 'items', id), { name: newName.trim(), price: newPrice });
        await loadItems();
      } catch (err) {
        console.error('Edit item error:', err);
        alert('Could not edit item: ' + err.message);
      }
    }

    // Load items & render table and price cards
    async function loadItems() {
      const tbody = document.querySelector('#itemsTable tbody');
      const priceGrid = document.getElementById('priceGrid');
      tbody.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
      priceGrid.innerHTML = '';

      try {
        const q = query(collection(db, 'items'), orderBy('createdAt', 'desc'));
        const snap = await getDocs(q);
        if (snap.empty) {
          tbody.innerHTML = '<tr><td colspan="5">No items found</td></tr>';
          priceGrid.innerHTML = '<div class="empty-state"><i class="fas fa-tag"></i><h3>No prices</h3><p>Add items to see them here.</p></div>';
          statItems.textContent = '0';
          return;
        }

        const rows = [];
        let count = 0;
        let lastSale = '-';
        for (const docSnap of snap.docs) {
          count++;
          const d = docSnap.data();
          const id = docSnap.id;
          const createdAt = d.createdAt && d.createdAt.toDate ? d.createdAt.toDate().toLocaleString() : '-';
          rows.push(`<tr>
            <td>${escapeHtml(d.name || '-')}</td>
            <td>â‚¦ ${(d.price != null) ? Number(d.price).toFixed(2) : '-'}</td>
            <td>${escapeHtml(d.createdByEmail || '')}</td>
            <td>${createdAt}</td>
            <td>
              <div style="display:flex;gap:8px;">
                <button class="btn-edit-table" onclick="editItem('${id}')"><i class="fas fa-edit"></i></button>
                <button class="btn-delete-table" onclick="deleteItem('${id}')"><i class="fas fa-trash"></i></button>
              </div>
            </td>
          </tr>`);

          // price card
          priceGrid.innerHTML += `<div class="card">
            <h4 style="margin:0 0 12px 0;">${escapeHtml(d.name || '-')}</h4>
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="color:var(--muted);font-size:13px;">Price</div>
              <div style="font-weight:800;">â‚¦ ${(d.price != null) ? Number(d.price).toFixed(2) : '-'}</div>
            </div>
          </div>`;
        }

        tbody.innerHTML = rows.join('');
        statItems.textContent = String(count);
        statLastSale.textContent = lastSale;
      } catch (err) {
        console.error('Load items error:', err);
        tbody.innerHTML = `<tr><td colspan="5">Error loading items: ${escapeHtml(err.message || 'unknown')}</td></tr>`;
      }
    }

    // Lookup
    const lookupInput = document.getElementById('lookupInput');
    const lookupResults = document.getElementById('lookupResults');
    if (lookupInput) {
      lookupInput.addEventListener('input', async (e) => {
        const qText = (e.target.value || '').trim().toLowerCase();
        lookupResults.innerHTML = '';
        if (!qText) return;
        try {
          // naive client-side search: load items and filter
          const snap = await getDocs(collection(db, 'items'));
          const matches = snap.docs.map(d => ({ id: d.id, ...d.data() }))
            .filter(it => (it.name||'').toLowerCase().includes(qText));
          if (!matches.length) {
            lookupResults.innerHTML = '<div style="padding:12px;">No matches</div>';
            return;
          }
          lookupResults.innerHTML = matches.map(m => `<div style="padding:10px;border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center;">
            <div><strong>${escapeHtml(m.name)}</strong><div style="font-size:12px;color:var(--muted)">${m.price != null ? 'â‚¦'+Number(m.price).toFixed(2) : ''}</div></div>
            <button class="btn-primary" style="padding:8px 10px; font-size:13px;" onclick='alert("Selected: ${escapeJs(m.name||'')}")'>Select</button>
          </div>`).join('');
        } catch (err) {
          console.error('Lookup error:', err);
          lookupResults.innerHTML = '<div style="padding:12px;color:#b91c1c">Lookup failed</div>';
        }
      });
    }

    // small helpers to avoid injection in generated HTML
    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/[&<>"']/g, (m) => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }
    function escapeJs(str) {
      if (!str) return '';
      return String(str).replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    // Expose functions global for inline onclick handlers
    window.toggleSidebar = toggleSidebar;
    window.showWelcome = showWelcome;
    window.showInventory = showInventory;
    window.showPOS = showPOS;
    window.showPriceList = showPriceList;
    window.showCustomers = showCustomers;
    window.showItemLookup = showItemLookup;
    window.showComingSoon = showComingSoon;
    window.logout = logout;
    window.addItem = addItem;
    window.loadItems = loadItems;
    window.deleteItem = deleteItem;
    window.editItem = editItem;

    // Friendly warning if config incorrect
    if (!firebaseConfig.apiKey || firebaseConfig.apiKey === 'YOUR_API_KEY') {
      console.warn('Firebase config appears to be placeholders. Replace firebaseConfig with your project values.');
    }

    // On load: try to keep UI ready (if user already authenticated, onAuthStateChanged will switch)
    document.addEventListener('DOMContentLoaded', () => {
      // ensure home visible initially
      showWelcome();
    });
  </script>
</body>
</html>
